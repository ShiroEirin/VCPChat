[根目录](../../CLAUDE.md) > **Canvasmodules**

# Canvasmodules 画布协同模块

## 变更记录 (Changelog)

- 2025-09-30 19:47:17: 初始化模块文档

## 模块职责

Canvasmodules 提供革命性的实时协同编辑空间，用户或AI可以随时创建集成了完整开发与渲染环境的"活文档"和"交互式白板"。它支持零延迟的共同编辑、沙盒化编译执行和版本回溯等功能。

## 模块结构

### 核心文件
- **canvas.html** - 画布主界面
- **canvas.js** - 画布核心逻辑
- **canvas.css** - 画布样式文件

## 核心功能特性

### 无缝协同编辑
- **零延迟同步** - 用户与AI像使用Google Docs一样共同编辑
- **实时协作** - 每处改动都会实时同步给所有参与者
- **多光标显示** - 显示不同用户的编辑光标位置
- **冲突解决** - 智能处理编辑冲突和合并

### 群组协同集成
- **群组Canvas** - 深度整合进群聊模式
- **多Agent协作** - 用户和多个Agent共同编辑同一Canvas
- **群文件区同步** - 与群文件区的文档实时同步
- **团队协作** - 像人类开发团队一样无缝协作

### 内置全功能IDE
- **沙盒化执行** - 安全的沙盒环境编译运行代码
- **即时调试** - 错误、日志和输出立即显示
- **VChat超级渲染器集成** - 支持HTML、Mermaid、Python等预览
- **所见即所得** - 代码实时预览和渲染

### 文档类型管理
- **代码支持** - .js, .py, .html, .css等代码文件
- **文档支持** - .md, .txt, .latex等文档格式
- **项目结构** - 支持文件夹和标签系统管理
- **分类归档** - 不同类型文档的分类和归档

### 版本控制系统
- **变动节点** - 每次重要保存在时间轴创建节点
- **节点线图谱** - 直观显示文档演变历史的节点线
- **版本对比** - 对比不同版本间的差异
- **一键回溯** - 回溯到任意历史节点

## 技术实现

### 协同编辑算法
- **操作转换(OT)** - 处理并发编辑操作
- **CRDT算法** - 无冲突复制数据类型
- **状态同步** - 客户端状态与服务器同步
- **事件驱动** - 基于事件的编辑处理

### 代码执行环境
- **WebAssembly** - 使用Pyodide执行Python代码
- **iframe沙箱** - 安全的HTML/CSS/JS执行环境
- **Worker线程** - 后台代码编译和执行
- **权限控制** - 细粒度的代码执行权限管理

### 渲染引擎集成
- **Markdown渲染** - 实时Markdown预览
- **代码高亮** - 多语言语法高亮
- **图表渲染** - Mermaid流程图和图表
- **数学公式** - KaTeX数学公式渲染

### 文件系统
- **虚拟文件系统** - 内存中的文件系统管理
- **持久化存储** - 自动保存到本地存储
- **导入导出** - 支持多种格式的导入导出
- **文件监听** - 外部文件变化监听和同步

## 配置选项

### 编辑器设置
- **主题模式** - 明暗主题和代码高亮主题
- **字体设置** - 编辑器字体和大小配置
- **自动保存** - 自动保存间隔和策略
- **缩进设置** - 缩进风格和大小

### 协作设置
- **权限控制** - 编辑、评论、只读权限设置
- **同步策略** - 实时同步或手动同步
- **冲突处理** - 冲突解决策略选择
- **用户标识** - 协作用户颜色和标识

### 执行环境
- **执行权限** - 代码执行权限和安全级别
- **资源限制** - CPU和内存使用限制
- **网络访问** - 外部网络访问控制
- **超时设置** - 代码执行超时时间

## 使用场景

### AI概念验证
- **原型开发** - AI创建可运行的交互式项目原型
- **快速验证** - 概念和想法的快速实现验证
- **迭代优化** - 基于反馈快速迭代改进

### 人机结对编程
- **代码重构** - AI协助重构和优化代码
- **功能开发** - 协作添加新功能和特性
- **问题调试** - 共同诊断和解决代码问题

### 交互式学习
- **编程教学** - AI作为导师手把手教学
- **概念演示** - 直观展示抽象概念
- **实践训练** - 提供编程练习和指导

### 文档协作
- **技术文档** - 协作编写技术文档
- **项目规划** - 共同制定项目计划
- **知识分享** - 团队知识整理和分享

## 常见问题 (FAQ)

### Q: 如何邀请其他用户协作编辑？
A: 在群聊中创建Canvas，所有群组成员都可以参与协作，或通过分享链接邀请。

### Q: 代码执行的安全性如何保障？
A: 使用沙盒环境和权限控制，限制代码的访问范围和系统调用。

### Q: 版本历史会占用大量空间吗？
A: 只保存关键节点的差异信息，采用增量存储，空间占用较小。

### Q: 支持哪些编程语言？
A: 支持Python、JavaScript、HTML、CSS、Markdown等主流语言，可扩展支持更多语言。

## 相关文件清单

### 核心文件
- canvas.html - 画布主界面
- canvas.js - 核心逻辑实现
- canvas.css - 样式定义

### 依赖文件
- vendor/pyodide.js - Python执行环境
- vendor/marked.min.js - Markdown渲染器
- vendor/katex.min.js - 数学公式渲染器
- vendor/mermaid.min.js - 图表渲染器
- modules/ipc/canvasHandlers.js - Canvas IPC处理器

### 协作文件
- 依赖WebSocket实时通信
- 依赖群组模块的协同功能
- 依赖文件管理器的文件操作

---

*本文档由 AI 自动生成，最后更新时间: 2025-09-30 19:47:17*